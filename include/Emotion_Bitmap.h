#ifndef EMOTION_BITMAP_H
#define EMOTION_BITMAP_H

#include <Arduino.h>
#include <U8g2lib.h>

/**
 * Ë°®ÊÉÖÂ∫ì - ÂÉèÁ¥†Á∫ßË°®ÊÉÖÁªòÂà∂
 * ‰ΩøÁî®U8g2ÁöÑdrawBitmap()ÂÆûÁé∞ÂÉèÁ¥†Á∫ßÊéßÂà∂
 * ÊîØÊåÅËá™ÂÆö‰πâË°®ÊÉÖÂíåÂä®ÁîªÂ∫èÂàó
 */

// ==================== Ë°®ÊÉÖÊï∞ÊçÆÁªìÊûÑ ====================

/**
 * ÂçïÂ∏ßË°®ÊÉÖÊï∞ÊçÆ
 */
struct EmotionFrame {
    const unsigned char* bitmap;  // ‰ΩçÂõæÊï∞ÊçÆÊåáÈíà
    uint8_t width;                // ‰ΩçÂõæÂÆΩÂ∫¶ÔºàÂÉèÁ¥†Ôºâ
    uint8_t height;               // ‰ΩçÂõæÈ´òÂ∫¶ÔºàÂÉèÁ¥†Ôºâ
    uint16_t duration;            // ÊòæÁ§∫Êó∂ÈïøÔºàÊØ´ÁßíÔºâ
};

/**
 * Ë°®ÊÉÖÂ∫èÂàóÔºàÊîØÊåÅÂä®ÁîªÔºâ
 */
struct EmotionSequence {
    const EmotionFrame* frames;
    uint8_t frameCount;           // ÊÄªÂ∏ßÊï∞
};

// ==================== Ë°®ÊÉÖ‰ΩçÂõæÂÆö‰πâ ====================

// HAPPY üòä (32x32 ÂÉèÁ¥†)
static const unsigned char BITMAP_HAPPY[] PROGMEM = {
    // ÂúÜËÑ∏Ê°Ü
    0x00, 0x00, 0x1C, 0x00,
    0x00, 0x00, 0x3E, 0x00,
    0x00, 0x00, 0x7F, 0x00,
    0x00, 0x00, 0xFF, 0x80,
    0x00, 0x01, 0xFF, 0xC0,
    0x00, 0x03, 0xFF, 0xE0,
    0x00, 0x07, 0xFF, 0xF0,
    0x00, 0x0F, 0xFF, 0xF8,
    0x00, 0x1F, 0xFF, 0xFC,
    0x00, 0x3F, 0xFF, 0xFE,
    0x00, 0x7F, 0xFF, 0xFF,
    0x00, 0xFF, 0xFF, 0xFF,
    0x01, 0xFF, 0xFF, 0xFF,
    0x03, 0xFF, 0xFF, 0xFF,
    0x07, 0xFF, 0xFF, 0xFF,
    0x0F, 0xFF, 0xFF, 0xFF,
    0x0F, 0xFF, 0xFF, 0xFF,
    0x07, 0xFF, 0xFF, 0xFF,
    0x03, 0xFF, 0xFF, 0xFF,
    0x01, 0xFF, 0xFF, 0xFF,
    0x00, 0xFF, 0xFF, 0xFF,
    0x00, 0x7F, 0xFF, 0xFF,
    0x00, 0x3F, 0xFF, 0xFE,
    0x00, 0x1F, 0xFF, 0xFC,
    0x00, 0x0F, 0xFF, 0xF8,
    0x00, 0x07, 0xFF, 0xF0,
    0x00, 0x03, 0xFF, 0xE0,
    0x00, 0x01, 0xFF, 0xC0,
    0x00, 0x00, 0xFF, 0x80,
    0x00, 0x00, 0x7F, 0x00,
    0x00, 0x00, 0x3E, 0x00,
    0x00, 0x00, 0x1C, 0x00,
    // Â∑¶ÁúºÂíåÁúâÊØõ
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x18, 0x00, 0x00,
    0x00, 0x3C, 0x00, 0x00,
    0x00, 0x3C, 0x00, 0x00,
    0x00, 0x18, 0x00, 0x00,
    // Âè≥ÁúºÂíåÁúâÊØõ
    0x00, 0x00, 0x18, 0x00,
    0x00, 0x00, 0x3C, 0x00,
    0x00, 0x00, 0x3C, 0x00,
    0x00, 0x00, 0x18, 0x00,
    // ÂºÄÂøÉÁöÑÂò¥ (ÂºßÂΩ¢)
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x07, 0xE0, 0x00,
    0x00, 0x0F, 0xF0, 0x00,
    0x00, 0x1F, 0xF8, 0x00,
    0x00, 0x1F, 0xF8, 0x00,
    0x00, 0x0F, 0xF0, 0x00,
    0x00, 0x07, 0xE0, 0x00,
};

// SAD üò¢ (32x32 ÂÉèÁ¥†)
static const unsigned char BITMAP_SAD[] PROGMEM = {
    // ÂúÜËÑ∏Ê°Ü (‰∏éHAPPYÁõ∏Âêå)
    0x00, 0x00, 0x1C, 0x00,
    0x00, 0x00, 0x3E, 0x00,
    0x00, 0x00, 0x7F, 0x00,
    0x00, 0x00, 0xFF, 0x80,
    0x00, 0x01, 0xFF, 0xC0,
    0x00, 0x03, 0xFF, 0xE0,
    0x00, 0x07, 0xFF, 0xF0,
    0x00, 0x0F, 0xFF, 0xF8,
    0x00, 0x1F, 0xFF, 0xFC,
    0x00, 0x3F, 0xFF, 0xFE,
    0x00, 0x7F, 0xFF, 0xFF,
    0x00, 0xFF, 0xFF, 0xFF,
    0x01, 0xFF, 0xFF, 0xFF,
    0x03, 0xFF, 0xFF, 0xFF,
    0x07, 0xFF, 0xFF, 0xFF,
    0x0F, 0xFF, 0xFF, 0xFF,
    0x0F, 0xFF, 0xFF, 0xFF,
    0x07, 0xFF, 0xFF, 0xFF,
    0x03, 0xFF, 0xFF, 0xFF,
    0x01, 0xFF, 0xFF, 0xFF,
    0x00, 0xFF, 0xFF, 0xFF,
    0x00, 0x7F, 0xFF, 0xFF,
    0x00, 0x3F, 0xFF, 0xFE,
    0x00, 0x1F, 0xFF, 0xFC,
    0x00, 0x0F, 0xFF, 0xF8,
    0x00, 0x07, 0xFF, 0xF0,
    0x00, 0x03, 0xFF, 0xE0,
    0x00, 0x01, 0xFF, 0xC0,
    0x00, 0x00, 0xFF, 0x80,
    0x00, 0x00, 0x7F, 0x00,
    0x00, 0x00, 0x3E, 0x00,
    0x00, 0x00, 0x1C, 0x00,
    // ‰º§ÂøÉÁöÑÁúºÁùõ (Ê≥™Êª¥)
    0x00, 0x18, 0x00, 0x18,
    0x00, 0x3C, 0x00, 0x3C,
    0x00, 0x3C, 0x00, 0x3C,
    0x00, 0x18, 0x00, 0x18,
    // ‰º§ÂøÉÁöÑÂò¥ (ÂÄíÂºßÂΩ¢)
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x07, 0xE0, 0x00,
    0x00, 0x0F, 0xF0, 0x00,
    0x00, 0x1F, 0xF8, 0x00,
    0x00, 0x1F, 0xF8, 0x00,
    0x00, 0x0F, 0xF0, 0x00,
    0x00, 0x07, 0xE0, 0x00,
};

// ANGRY üò† (32x32 ÂÉèÁ¥†)
static const unsigned char BITMAP_ANGRY[] PROGMEM = {
    // ÂúÜËÑ∏Ê°Ü
    0x00, 0x00, 0x1C, 0x00,
    0x00, 0x00, 0x3E, 0x00,
    0x00, 0x00, 0x7F, 0x00,
    0x00, 0x00, 0xFF, 0x80,
    0x00, 0x01, 0xFF, 0xC0,
    0x00, 0x03, 0xFF, 0xE0,
    0x00, 0x07, 0xFF, 0xF0,
    0x00, 0x0F, 0xFF, 0xF8,
    0x00, 0x1F, 0xFF, 0xFC,
    0x00, 0x3F, 0xFF, 0xFE,
    0x00, 0x7F, 0xFF, 0xFF,
    0x00, 0xFF, 0xFF, 0xFF,
    0x01, 0xFF, 0xFF, 0xFF,
    0x03, 0xFF, 0xFF, 0xFF,
    0x07, 0xFF, 0xFF, 0xFF,
    0x0F, 0xFF, 0xFF, 0xFF,
    0x0F, 0xFF, 0xFF, 0xFF,
    0x07, 0xFF, 0xFF, 0xFF,
    0x03, 0xFF, 0xFF, 0xFF,
    0x01, 0xFF, 0xFF, 0xFF,
    0x00, 0xFF, 0xFF, 0xFF,
    0x00, 0x7F, 0xFF, 0xFF,
    0x00, 0x3F, 0xFF, 0xFE,
    0x00, 0x1F, 0xFF, 0xFC,
    0x00, 0x0F, 0xFF, 0xF8,
    0x00, 0x07, 0xFF, 0xF0,
    0x00, 0x03, 0xFF, 0xE0,
    0x00, 0x01, 0xFF, 0xC0,
    0x00, 0x00, 0xFF, 0x80,
    0x00, 0x00, 0x7F, 0x00,
    0x00, 0x00, 0x3E, 0x00,
    0x00, 0x00, 0x1C, 0x00,
    // ÁîüÊ∞îÁöÑÁúâÊØõÂíåÁúºÁùõ
    0x0F, 0x00, 0x00, 0xF0,
    0x1F, 0x80, 0x01, 0xF8,
    0x0F, 0x80, 0x01, 0xF0,
    0x07, 0x00, 0x00, 0xE0,
    // ÁîüÊ∞îÁöÑÂò¥ (Áõ¥Á∫ø)
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x0F, 0xF0, 0x00,
    0x00, 0x0F, 0xF0, 0x00,
    0x00, 0x0F, 0xF0, 0x00,
    0x00, 0x0F, 0xF0, 0x00,
    0x00, 0x0F, 0xF0, 0x00,
    0x00, 0x07, 0xE0, 0x00,
};

// HOT_WARNING üî• (Ë°®Á§∫Â§™ÁÉ≠)
static const unsigned char BITMAP_HOT[] PROGMEM = {
    // Á∫¢Ëâ≤ÁöÑËÑ∏
    0x00, 0x00, 0x1C, 0x00,
    0x00, 0x00, 0x3E, 0x00,
    0x00, 0x00, 0x7F, 0x00,
    0x00, 0x00, 0xFF, 0x80,
    0x00, 0x01, 0xFF, 0xC0,
    0x00, 0x03, 0xFF, 0xE0,
    0x00, 0x07, 0xFF, 0xF0,
    0x00, 0x0F, 0xFF, 0xF8,
    0x00, 0x1F, 0xFF, 0xFC,
    0x00, 0x3F, 0xFF, 0xFE,
    0x00, 0x7F, 0xFF, 0xFF,
    0x00, 0xFF, 0xFF, 0xFF,
    0x01, 0xFF, 0xFF, 0xFF,
    0x03, 0xFF, 0xFF, 0xFF,
    0x07, 0xFF, 0xFF, 0xFF,
    0x0F, 0xFF, 0xFF, 0xFF,
    0x0F, 0xFF, 0xFF, 0xFF,
    0x07, 0xFF, 0xFF, 0xFF,
    0x03, 0xFF, 0xFF, 0xFF,
    0x01, 0xFF, 0xFF, 0xFF,
    0x00, 0xFF, 0xFF, 0xFF,
    0x00, 0x7F, 0xFF, 0xFF,
    0x00, 0x3F, 0xFF, 0xFE,
    0x00, 0x1F, 0xFF, 0xFC,
    0x00, 0x0F, 0xFF, 0xF8,
    0x00, 0x07, 0xFF, 0xF0,
    0x00, 0x03, 0xFF, 0xE0,
    0x00, 0x01, 0xFF, 0xC0,
    0x00, 0x00, 0xFF, 0x80,
    0x00, 0x00, 0x7F, 0x00,
    0x00, 0x00, 0x3E, 0x00,
    0x00, 0x00, 0x1C, 0x00,
    // ÊµÅÊ±óÁöÑÁúºÁùõ
    0x00, 0x18, 0x00, 0x18,
    0x00, 0x3C, 0x00, 0x3C,
    0x00, 0x3C, 0x00, 0x3C,
    0x00, 0x18, 0x00, 0x18,
    // ÊµÅÊ±óÁöÑÂò¥ (Âº†Âè£)
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x07, 0xE0, 0x00,
    0x00, 0x0F, 0xF0, 0x00,
    0x00, 0x1F, 0xF8, 0x00,
    0x00, 0x1F, 0xF8, 0x00,
    0x00, 0x0F, 0xF0, 0x00,
    0x00, 0x07, 0xE0, 0x00,
};

// HEART üíó (Áà±ÂøÉ)
static const unsigned char BITMAP_HEART[] PROGMEM = {
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x06, 0x60, 0x00,
    0x00, 0x0F, 0xF0, 0x00,
    0x00, 0x1F, 0xF8, 0x00,
    0x00, 0x3F, 0xFC, 0x00,
    0x00, 0x7F, 0xFE, 0x00,
    0x00, 0xFF, 0xFF, 0x00,
    0x01, 0xFF, 0xFF, 0x80,
    0x01, 0xFF, 0xFF, 0x80,
    0x01, 0xFF, 0xFF, 0x80,
    0x00, 0xFF, 0xFF, 0x00,
    0x00, 0x7F, 0xFE, 0x00,
    0x00, 0x3F, 0xFC, 0x00,
    0x00, 0x1F, 0xF8, 0x00,
    0x00, 0x0F, 0xF0, 0x00,
    0x00, 0x06, 0x60, 0x00,
    0x00, 0x00, 0x00, 0x00,
};

// SUN ‚òÄÔ∏è (Â§™Èò≥ - Â§©Ê∞îÊô¥Êúó)
static const unsigned char BITMAP_SUN[] PROGMEM = {
    0x00, 0x03, 0xC0, 0x00,
    0x00, 0x07, 0xE0, 0x00,
    0x00, 0x0F, 0xF0, 0x00,
    0x00, 0x1F, 0xF8, 0x00,
    0x00, 0x1F, 0xF8, 0x00,
    0x00, 0x0F, 0xF0, 0x00,
    0x00, 0x07, 0xE0, 0x00,
    0x00, 0x03, 0xC0, 0x00,
    0x60, 0x00, 0x00, 0x06,
    0xF0, 0x00, 0x00, 0x0F,
};

// RAIN üåßÔ∏è (‰∏ãÈõ®)
static const unsigned char BITMAP_RAIN[] PROGMEM = {
    0x00, 0x3F, 0xFC, 0x00,
    0x00, 0x7F, 0xFE, 0x00,
    0x00, 0xFF, 0xFF, 0x00,
    0x01, 0xFF, 0xFF, 0x80,
    0x01, 0xFF, 0xFF, 0x80,
    0x00, 0xFF, 0xFF, 0x00,
    0x00, 0x7F, 0xFE, 0x00,
    0x00, 0x3F, 0xFC, 0x00,
    0x18, 0x18, 0x18, 0x18,
    0x3C, 0x3C, 0x3C, 0x3C,
};

// CLOUD ‚òÅÔ∏è (Èò¥Â§©)
static const unsigned char BITMAP_CLOUD[] PROGMEM = {
    0x00, 0x01, 0xF8, 0x00,
    0x00, 0x03, 0xFC, 0x00,
    0x00, 0x07, 0xFE, 0x00,
    0x00, 0x0F, 0xFF, 0x00,
    0x7F, 0xFF, 0xFF, 0xFE,
    0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF,
    0x7F, 0xFF, 0xFF, 0xFE,
    0x00, 0x0F, 0xFF, 0x00,
    0x00, 0x07, 0xFE, 0x00,
};

// ==================== Ë°®ÊÉÖÁÆ°ÁêÜÁ±ª ====================

class EmotionBitmapLibrary {
private:
    U8G2_SSD1315_128X64_1_HW_I2C* display;
    
public:
    EmotionBitmapLibrary();
    
    /**
     * ÂàùÂßãÂåñË°®ÊÉÖÂ∫ì
     */
    void begin(U8G2_SSD1315_128X64_1_HW_I2C* disp) {
        display = disp;
    }
    
    /**
     * ÁªòÂà∂Ë°®ÊÉÖ‰ΩçÂõæ
     * @param bitmap ‰ΩçÂõæÊï∞ÊçÆ
     * @param x XÂùêÊ†á
     * @param y YÂùêÊ†á
     * @param w ÂÆΩÂ∫¶
     * @param h È´òÂ∫¶
     */
    void drawEmotionBitmap(const unsigned char* bitmap, 
                          uint8_t x, uint8_t y, 
                          uint8_t w, uint8_t h) {
        if (display) {
            display->drawBitmap(x, y, (const uint8_t*)bitmap, w, h, 1);
            display->sendBuffer();
        }
    }
    
    /**
     * ÁªòÂà∂Â§©Ê∞îÂõæÊ†á
     */
    void drawWeatherIcon(const char* weather, uint8_t x, uint8_t y) {
        if (strstr(weather, "Êô¥") || strstr(weather, "sunny")) {
            drawEmotionBitmap(BITMAP_SUN, x, y, 32, 16);
        } 
        else if (strstr(weather, "Èõ®") || strstr(weather, "rain")) {
            drawEmotionBitmap(BITMAP_RAIN, x, y, 32, 16);
        }
        else if (strstr(weather, "‰∫ë") || strstr(weather, "cloud")) {
            drawEmotionBitmap(BITMAP_CLOUD, x, y, 32, 16);
        }
    }
    
    /**
     * ÁªòÂà∂Ë°®ÊÉÖÔºàÂ∏¶È¢úËâ≤ÂèçËΩ¨ÊïàÊûúÔºâ
     */
    void drawEmotionAnimated(const unsigned char* bitmap, 
                            uint8_t x, uint8_t y, 
                            uint8_t w, uint8_t h,
                            bool inverse = false) {
        display->clearBuffer();
        if (inverse) {
            display->setDrawColor(0);  // ÂèçËâ≤
        }
        drawEmotionBitmap(bitmap, x, y, w, h);
        if (inverse) {
            display->setDrawColor(1);  // ÊÅ¢Â§ç
        }
    }
};

#endif
