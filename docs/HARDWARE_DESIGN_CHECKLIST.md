# 硬件原理图设计检查清单
## SmartDesk 基于数据手册的最终设计指南

**版本**: 1.0  
**日期**: 2026年2月5日  
**设计阶段**: 原理图设计中

---

## 🎯 快速核对表 (打印使用)

### 第一部分: 引脚分配核对

```
□ PA0  - 舵机1摇头 PWM (TIM2_CH1)     ← 不与启动冲突 ✅
□ PA1  - DHT11温湿度 GPIO             ← 单独GPIO ✅
□ PA2  - USART2 TX (ASRPRO)           ← 默认引脚 ✅
□ PA3  - USART2 RX (ASRPRO)           ← 默认引脚 ✅
□ PA5  - 舵机2点头 PWM (TIM2_CH2)     ← 不与其他冲突 ✅
□ PB6  - I2C1 SCL (OLED)              ← 硬件SCL ✅
□ PB7  - I2C1 SDA (OLED)              ← 硬件SDA ✅
□ PB10 - USART3 TX (ESP8266)          ← 默认引脚 ✅
□ PB11 - USART3 RX (ESP8266)          ← 默认引脚 ✅
```

### 第二部分: 通信协议核对

```
I2C配置 (I2C1):
  □ SCL = PB6              ✅
  □ SDA = PB7              ✅
  □ 频率 = 100kHz-400kHz   ✅
  □ 地址 = 0x3C (OLED)    ✅
  □ 上拉电阻 = 4.7kΩ      ✅

UART2 (ASRPRO语音):
  □ TX = PA2               ✅
  □ RX = PA3               ✅
  □ 波特率 = 9600          ✅
  □ 无需重映射             ✅

UART3 (ESP8266 WiFi):
  □ TX = PB10              ✅
  □ RX = PB11              ✅
  □ 波特率 = 115200        ✅
  □ 无需重映射             ✅
```

### 第三部分: 电源配置核对 ⚠️ 重要

```
3.3V系统 (STM32主控):
  □ 容量需求 ≥ 800mA LDO (推荐AMS1117-3.3)
  □ 输入电源 = 5V (来自主电源)
  □ 输出模块 = STM32 + OLED + DHT11
  □ 滤波电容:
    □ 输入端: 1000μF + 100nF
    □ 输出端: 100μF + 100nF

3.3V独占系统 (ESP8266 WiFi):
  □ 单独LDO (推荐AMS1117-3.3)
  □ 容量需求 ≥ 500mA
  □ 输入电源 = 5V (来自主电源)
  □ 滤波电容:
    □ 输入端: 100μF + 100nF
    □ 输出端: 100μF + 100nF

5V系统 (舵机+语音模块):
  □ 电源容量 ≥ 2A (瞬时峰值可达1.6A)
  □ 推荐来源: USB-C PD 或独立DC电源
  □ 舵机1 (SG90) - 5V直接
  □ 舵机2 (SG90) - 5V直接
  □ ASRPRO语音 - 5V直接 (信号线3.3V)
  □ 滤波电容:
    □ 输入端: 1000μF + 100nF
    □ 各模块靠近: 100μF + 100nF
```

### 第四部分: 共地与隔离核对

```
接地拓扑 (星形接地):
  □ 所有GND通过粗铜线(建议≥20AWG)连接
  □ 中心节点: STM32开发板的GND
  □ 从GND点:
    □ OLED GND ←→ 中心
    □ DHT11 GND ←→ 中心
    □ ASRPRO GND ←→ 中心
    □ ESP8266 GND ←→ 中心
    □ 舵机1 GND ←→ 中心
    □ 舵机2 GND ←→ 中心
  □ 禁止: 模块之间串联GND

电源隔离:
  □ 5V系统与3.3V系统分离供电
  □ 两个3.3V供应源独立 (主系统 vs WiFi)
  □ 所有GND共地 (电气连接)
  □ 仅在电源端形成环路
```

### 第五部分: 信号完整性核对

```
I2C总线 (PB6/PB7):
  □ 开漏输出配置
  □ 上拉电阻 = 4.7kΩ (两条线)
  □ 总线长度 < 30cm (面包板/PCB建议)
  □ 无并行高速信号干扰
  □ 示波器测试: 上升沿陡峭 (< 1μs)

UART2 (PA2/PA3):
  □ 信号摆幅 3.3V (正常范围)
  □ 波特率 = 9600 bps
  □ 无需分压/升压电路
  □ 屏蔽: 建议绞合屏蔽线 (可选)

UART3 (PB10/PB11):
  □ 信号摆幅 3.3V (STM32输出) → ESP8266输入
  □ 波特率 = 115200 bps
  □ 无需分压/升压电路
  □ 屏蔽: 建议绞合屏蔽线 (可选)

PWM输出 (PA0/PA5):
  □ 频率 = 50Hz (舵机标准)
  □ 脉宽范围 = 1-2ms (90°位置)
  □ 驱动能力 = 3mA以上
  □ 杂波: 应 < 50mV (使用CRO验证)
```

### 第六部分: 启动与调试核对

```
正常启动:
  □ BOOT0 = 0 (硬件默认)  → 从Flash启动
  □ 复位电路正常          → STM32自带
  □ 上电顺序 OK           → 先3.3V再5V推荐

调试接口 (SWD):
  □ PA13 (SWDIO) 未占用   ✅
  □ PA14 (SWCLK) 未占用   ✅
  □ SWD电源 3.3V          ✅
  □ SWD接口可用           ✅ (正常焊接)

复位按钮:
  □ 复位电路 = STM32自带
  □ 手动复位按钮 (可选)
  □ 复位电容 = STM32自带

晶振:
  □ 主晶振 = 8MHz (开发板自带)
  □ 无需修改               ✅
```

---

## 🔧 设计步骤指南

### 步骤1: 电源路由设计

```
优先级 (按此顺序):
1. 5V主电源输入 (USB或DC)
   ├─ 添加保险丝 (1-2A)
   ├─ 添加大容量滤波 (1000μF)
   └─ 分出3条线:
      ├─ 3.3V LDO1 输入 (主系统)
      ├─ 3.3V LDO2 输入 (ESP8266)
      └─ 直接5V (舵机+ASRPRO)

2. 3.3V LDO1 (用于STM32主系统)
   ├─ 输入滤波: 100μF + 100nF
   ├─ 输出: STM32核心电源
   ├─ 输出滤波: 100μF + 100nF
   └─ GND回到中心星点

3. 3.3V LDO2 (用于ESP8266)
   ├─ 输入滤波: 100μF + 100nF
   ├─ 输出: ESP8266 VCC
   ├─ 输出滤波: 100μF + 100nF
   └─ GND回到中心星点

4. 5V直接配线 (舵机)
   ├─ 舵机1 VCC + GND
   ├─ 舵机2 VCC + GND
   ├─ ASRPRO VCC + GND
   └─ 每处添加100μF + 100nF滤波
```

### 步骤2: I2C总线设计

```
1. 布线:
   ├─ PB6 (SCL) 走粗线 (建议10mil以上)
   ├─ PB7 (SDA) 走粗线 (建议10mil以上)
   ├─ 尽量靠近 (电路板上 < 10cm)
   └─ 避免与高频信号并行

2. 上拉电阻:
   ├─ SCL上拉 (PB6): 4.7kΩ 到 3.3V
   ├─ SDA上拉 (PB7): 4.7kΩ 到 3.3V
   ├─ 电阻精度: ±5% 或更好
   └─ 安装位置: 尽量靠近STM32

3. OLED连接:
   ├─ OLED GND ← 中心星点
   ├─ OLED VCC ← 3.3V (来自LDO1)
   ├─ OLED SCL ← PB6 (通过上拉电阻)
   └─ OLED SDA ← PB7 (通过上拉电阻)

4. 绝缘与屏蔽 (可选):
   ├─ I2C总线: 可使用屏蔽线 (Ground到中心)
   └─ 长度 < 30cm时不必需
```

### 步骤3: UART串口设计

```
UART2 (ASRPRO 9600):
  1. PA2 (TX) → ASRPRO RX (直接)
  2. PA3 (RX) ← ASRPRO TX (直接)
  3. ASRPRO GND ← 中心星点
  4. ASRPRO VCC ← 5V电源
  5. 信号线可使用绞合屏蔽线 (可选)
  6. 线长 ≤ 1m 推荐

UART3 (ESP8266 115200):
  1. PB10 (TX) → ESP8266 RX (直接)
  2. PB11 (RX) ← ESP8266 TX (直接)
  3. ESP8266 GND ← 中心星点
  4. ESP8266 VCC ← 3.3V (LDO2专用)
  5. 信号线可使用绞合屏蔽线 (推荐!)
  6. 线长 ≤ 1m, 避免并行3.3V电源线
```

### 步骤4: PWM舵机设计

```
舵机1 (PA0 - 摇头):
  1. 信号线 (橙色) ← PA0
  2. 电源线 (红色) ← 5V
  3. 地线 (棕色) ← 中心星点
  4. 线长: ≤ 30cm 推荐
  5. 屏蔽: 不必需 (50Hz低频)

舵机2 (PA5 - 点头):
  1. 信号线 (橙色) ← PA5
  2. 电源线 (红色) ← 5V
  3. 地线 (棕色) ← 中心星点
  4. 线长: ≤ 30cm 推荐
  5. 屏蔽: 不必需 (50Hz低频)

舵机电源隔离:
  ├─ 两个舵机共享5V电源
  ├─ 但每个舵机靠近 100μF滤波
  ├─ 返回GND要分开 (最后汇合到星点)
  └─ 不要让舵机动作时电流经过I2C线
```

### 步骤5: DHT11温湿度传感器

```
DHT11连接:
  1. DATA (黄线) ← PA1 (GPIO)
  2. VCC (红线) ← 3.3V (LDO1)
  3. GND (黑线) ← 中心星点
  4. 可选: 上拉电阻 (建议添加 4.7kΩ DATA → 3.3V)

位置选择:
  ├─ 避免靠近发热体 (舵机/ASRPRO)
  ├─ 避免阳光直射
  ├─ 建议安装在通风位置
  └─ 线长 ≤ 1m
```

---

## ⚡ 电源配置详解 (原理图示例)

### 配置方案图

```
                 ┌─────────────────────┐
                 │  5V电源 (2A以上)    │
                 │  USB-C或DC          │
                 └──────────┬──────────┘
                            │
                      ┌─────┴─────┐
                      │  保险丝 1A │
                      └─────┬─────┘
                            │
                      ┌─────┴────────────┬─────────────────┐
                      │                  │                 │
                 ┌────▼────┐         ┌───▼───┐      ┌──────▼───┐
                 │ LDO-3.3V│         │LDO-3.3│      │ 5V直接   │
                 │ (STM32) │         │(WiFi) │      │(舵机等)  │
                 │ 1A      │         │500mA  │      │ 2A       │
                 └─┬───────┘         └───┬───┘      └──────┬───┘
                   │                     │                 │
          ┌────────┼─────────────────┐   │          ┌──────┼──────┐
          │        │                 │   │          │      │      │
          │   ┌────▼─────┐      ┌────▼───┘      ┌───▼──┐  │  ┌───▼──┐
          │   │STM32主控  │      │ESP8266        │Servo1│  │  │Servo2│
          │   │OLED       │      │WiFi           └──────┘  │  └──────┘
          │   │DHT11      │      │               │ASRPRO   │
          │   └───────────┘      └────────────────┴────────┘
          │
          └─────────────────────────┐
                                    │
                            ┌───────▼──────┐
                            │ 星形接地中心 │
                            │  (All GND)   │
                            └──────────────┘
```

---

## ✅ 最终设计检查单

在提交原理图之前，请依次检查:

### 电源系统
```
□ 3.3V LDO (主系统) 容量 ≥ 800mA
□ 3.3V LDO (WiFi) 容量 ≥ 500mA
□ 5V电源容量 ≥ 2A (峰值)
□ 所有LDO输入端有 1000μF电解 + 100nF钽
□ 所有LDO输出端有 100μF电解 + 100nF陶瓷
□ 所有模块靠近其电源端有本地滤波
□ 星形接地拓扑正确
□ 所有GND通过粗线连接到中心节点
```

### 通信接口
```
□ I2C总线: PB6(SCL) 和 PB7(SDA)
□ I2C上拉: 两条线各 4.7kΩ 到 3.3V
□ I2C总线长度 < 30cm
□ UART2: PA2(TX) PA3(RX) 9600bps
□ UART3: PB10(TX) PB11(RX) 115200bps
□ UART线长 ≤ 1m, 推荐绞合屏蔽
□ 无串口信号交叉
```

### 外设连接
```
□ 舵机1 (PA0): 信号/电源/地 正确
□ 舵机2 (PA5): 信号/电源/地 正确
□ DHT11 (PA1): DATA/VCC/GND 正确
□ OLED: SCL/SDA/VCC/GND 正确
□ ASRPRO: TX/RX/VCC/GND 正确
□ ESP8266: TX/RX/VCC/GND 正确
□ 所有VCC和GND连接无误
```

### 硬件完整性
```
□ 无忘记的去耦电容
□ 无并联冲突的信号线
□ 无短路风险
□ 所有关键节点有测试点
□ 复位电路完整 (STM32自带)
□ SWD调试接口可用 (PA13/PA14)
□ 无启动引脚冲突
```

---

## 🎓 常见错误预防

| 错误 | 后果 | 预防 |
|------|------|------|
| 忘记I2C上拉电阻 | OLED无显示 | 检查PB6/PB7上拉 |
| 舵机5V直接接3.3V | 舵机无力 | 确认5V电源独立 |
| ESP8266与主系统共3.3V | WiFi重启 | 使用独立LDO |
| UART电流过大 | 信号失真 | 检查波特率设置 |
| GND点太多 | 噪声大 | 使用星形接地 |
| 舵机电流回路不良 | PWM干扰 | 独立GND回路 |
| 忘记输入滤波 | 芯片不稳定 | 1000μF + 100nF |
| I2C线太长 | 信号衰减 | 保持 < 30cm |

---

## 📞 设计问题排查

**Q: I2C显示不了怎么办?**  
A: 检查清单:
  1. PB6=SCL, PB7=SDA 确认无误
  2. 上拉电阻 4.7kΩ 是否安装
  3. OLED VCC=3.3V, GND共地
  4. 使用I2C扫描程序检查地址 0x3C

**Q: 舵机动作时系统重启?**  
A: 电源问题:
  1. 舵机是否有独立5V电源 (≥2A)
  2. GND是否正确星形接地
  3. 是否有本地滤波电容 (100μF)
  4. 舵机电流是否经过I2C线

**Q: WiFi连接不稳定?**  
A: ESP8266隔离问题:
  1. 是否使用独立3.3V LDO
  2. 是否有输入/输出滤波 (100μF+100nF)
  3. TX/RX线是否屏蔽
  4. 是否远离3.3V主电源线

**Q: UART显示乱码?**  
A: 串口配置问题:
  1. 波特率是否正确 (ASRPRO=9600, ESP8266=115200)
  2. 接收端/发送端是否接反
  3. GND是否共地
  4. 线长是否太长 (> 2m)

---

## 📋 最后清单

**在开始PCB设计前，务必**:
- [ ] 所有5个问题均已核对
- [ ] 电源方案已确定并审批
- [ ] 引脚映射无误
- [ ] 无冲突风险
- [ ] 所有人员已知晓方案

**原理图设计**: ✅ **已批准，可以开始**

---

**设计文件版本**: v1.0  
**最后更新**: 2026年2月5日  
**设计者签字**: _________________  
**审核签字**: _________________

